{% extends 'base/echoes_base.html' %}
{% load widget_tweaks %}
{% block page_title %}
<h1 class="page-title">Create: Speaks</h1>
{% endblock %}
{% block body %}

<div class="container" style="max-width: 700px;">

  <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
    {% csrf_token %}

    <!-- Tweet（チェックボックス） -->
    <div class="mb-3">
      <label class="form-label" for="{{ form.repo_tweet.id_for_label }}">{{ form.repo_tweet.label }}</label>
      <div class="form-check">
        {{ form.repo_tweet|add_class:"form-check-input" }}
        <label class="form-check-label" for="{{ form.repo_tweet.id_for_label }}">報告じゃなくつぶやきたいときは押す</label>
      </div>
      {% for error in form.repo_tweet.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- 公開区分（セレクト） -->
    <div class="mb-3">
      <label class="form-label" for="{{ form.repo_publicity.id_for_label }}">{{ form.repo_publicity.label }}</label>
      {{ form.repo_publicity|add_class:"form-select" }}
      {% for error in form.repo_publicity.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- 場所区分（セレクト） -->
    <div class="mb-3">
      <label class="form-label" for="{{ form.repo_plac.id_for_label }}">{{ form.repo_plac.label }}</label>
      {{ form.repo_plac|add_class:"form-select" }}
      {% for error in form.repo_plac.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- 本文（textarea or text） -->
    <div class="mb-3">
      <label class="form-label" for="{{ form.repo_cont.id_for_label }}">{{ form.repo_cont.label }}</label>
      {{ form.repo_cont|add_class:"form-control" }}
      {% for error in form.repo_cont.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <!-- 投稿者（テキスト） -->
    <div class="mb-3">
      <label class="form-label" for="{{ form.repo_pter.id_for_label }}">{{ form.repo_pter.label }}</label>
      {{ form.repo_pter|add_class:"form-control" }}
      {% for error in form.repo_pter.errors %}
        <div class="text-danger small">{{ error }}</div>
      {% endfor %}
    </div>

    <button type="submit" class="btn btn-primary w-100">送信する</button>
  </form>
</div>



<script>
   const checkbox = document.getElementById("id_repo_tweet");
   const valueField = document.getElementById("id_repo_publicity");

   function toggleValueField() {
      if (checkbox.checked) {
         valueField.value = "only_staff"; // デフォルト値
         valueField.setAttribute("disabled", "disabled"); // 編集不可
      } else {
         valueField.removeAttribute("disabled");
      }
   }

   checkbox.addEventListener("change", toggleValueField);

   // 初期状態にも適用
   toggleValueField();
</script>
{% endblock %}